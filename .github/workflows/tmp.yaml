on:
  push:
    branches: "*"

jobs:
  trivy:
    name: üïµÔ∏è Trivy vulnerability scanner
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          ref: revolunet-patch-4
      - name: Scan domifa backend
        uses: ./actions/trivy-scan-image
        continue-on-error: true
        with:
          image: harbor.fabrique.social.gouv.fr/domifa/domifa/backend:v2.131.14
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Scan BPCO site 
        uses: ./actions/trivy-scan-image
        continue-on-error: true
        with:
          image: harbor.fabrique.social.gouv.fr/bpco-mieux/bpco-site/app:v1.4.9
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Scan template hasura
        uses: ./actions/trivy-scan-image
        continue-on-error: true
        with:
          image: harbor.fabrique.social.gouv.fr/fabrique/template/hasura:sha-a456cb35fc81f840c2f0bfa3cfd395fb68a9014a
          token: ${{ secrets.GITHUB_TOKEN }}
