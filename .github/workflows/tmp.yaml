on:
  push:
    branches: "*"

jobs:
  trivy:
    strategy:
      matrix:
        image:
          - harbor.fabrique.social.gouv.fr/domifa/domifa/backend:v2.131.14
          - harbor.fabrique.social.gouv.fr/bpco-mieux/bpco-site/app:v1.4.9
          - harbor.fabrique.social.gouv.fr/fabrique/template/hasura:sha-a456cb35fc81f840c2f0bfa3cfd395fb68a9014a
          
    name: üïµÔ∏è Trivy vulnerability scanner
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Scan ${{ matrix.image }}
        uses: ./actions/trivy-scan-image
        continue-on-error: true
        with:
          image: ${{ matrix.image }}
          token: ${{ secrets.GITHUB_TOKEN }}

